using RequestMaster.Databases.MainDatabase;
using RequestMaster.Patterns;
using System.Windows;
using System.Windows.Controls;

namespace RequestMaster.Tabs
{
    public partial class Profile : UserControl 
    {
        RequestsContext db;
        public Profile()
        {
            db = DatabaseSingleton.CreateInstance();
            InitializeComponent();
            refreshTab();
            createdRequestsDataGrid.AutoGeneratedColumns += createdRequestsDataGrid_AutoGeneratedColumns;
        }

        private void createdRequestsDataGrid_AutoGeneratedColumns(object? sender, EventArgs e)
        {
            createdRequestsDataGrid.Columns[0].Header = "ID";
            createdRequestsDataGrid.Columns[1].Header = "описание";
            createdRequestsDataGrid.Columns[2].Header = "номер";
            createdRequestsDataGrid.Columns[3].Header = "статус";
            createdRequestsDataGrid.Columns[4].Visibility = Visibility.Hidden;
            createdRequestsDataGrid.Columns[5].Visibility = Visibility.Hidden;
        }

        private void refreshButton_Click(object sender, RoutedEventArgs e)
        {
            refreshTab();
            App.logWriter!.WriteLine($"профиль: вкладка обновлена\t\t\t\t{(DateTime.Now).ToLongTimeString()}");
        }

        private void refreshTab()
        {
            textBoxLogin.Text = $"логин: {AuthWindow.login}";
            textBoxPassword.Text = $"пароль: {AuthWindow.password}";
            textBoxEmail.Text = $"почта: {AuthWindow.email}";
            createdRequestsDataGrid.ItemsSource = db.Requests.Where(x => x.whoCreatedID == 1).ToList();
        }
    }
}